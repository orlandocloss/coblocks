<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>coblocks</title>
    <link rel="icon" href="favicon.svg" type="image/svg+xml">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app">
        <!-- STAGE 1: Clean Map View -->
        <div id="mapStage" class="stage active">
            <div class="map-container">
                <div id="map" class="fullscreen-map"></div>
                <div class="map-overlay">
                    <div class="map-controls">
                        <button id="clearBoundary" class="control-btn">↻</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- STAGE 2: Loading Screen -->
        <div id="loadingStage" class="stage">
            <div class="loading-container">
                <div class="loading-bar" aria-label="loading">
                    <div id="loadingBarFill" class="loading-bar-fill"></div>
                </div>
            </div>
        </div>

        <!-- STAGE 3: Builder View -->
        <div id="builderStage" class="stage">
            <div class="builder-layout">
                <div class="builder-controls">
                    <!-- Camera Mode Controls -->
                    <div class="camera-mode-controls">
                        <button class="mode-btn" data-mode="rotate" title="Rotate View">
                            <span class="icon">↻</span>
                        </button>
                        <button class="mode-btn" data-mode="pan" title="Pan View">
                            <span class="icon">⇄</span>
                        </button>
                        <button class="mode-btn" data-mode="build" title="Build Blocks">
                            <span class="icon">⬛</span>
                        </button>
                        <button id="toggleMapOverlay" class="mode-btn active" title="Toggle Map">
                            <span class="icon">◐</span>
                        </button>
                    </div>
                </div>

                <div class="builder-main">
                    <div id="builderCanvas" class="builder-canvas"></div>
                    <div class="builder-stats">
                        <span>Blocks: <span id="blockCount">0</span></span>
                        <span>Grid: <span id="gridSize">0×0</span></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Color Picker Popup -->
        <div id="colorPickerPopup" class="color-picker-popup hidden">
            <div class="color-picker-header">
                <span>Block Color</span>
                <button id="closeColorPicker" class="close-btn">×</button>
            </div>
            <div class="color-picker-content">
                <div class="color-presets">
                    <div class="color-preset" data-color="#ff4444" style="background-color: #ff4444;" title="Red"></div>
                    <div class="color-preset" data-color="#44ff44" style="background-color: #44ff44;" title="Green"></div>
                    <div class="color-preset" data-color="#4444ff" style="background-color: #4444ff;" title="Blue"></div>
                    <div class="color-preset" data-color="#ffff44" style="background-color: #ffff44;" title="Yellow"></div>
                    <div class="color-preset" data-color="#ff44ff" style="background-color: #ff44ff;" title="Magenta"></div>
                    <div class="color-preset" data-color="#44ffff" style="background-color: #44ffff;" title="Cyan"></div>
                    <div class="color-preset" data-color="#ff8844" style="background-color: #ff8844;" title="Orange"></div>
                    <div class="color-preset" data-color="#8844ff" style="background-color: #8844ff;" title="Purple"></div>
                    <div class="color-preset" data-color="#ffffff" style="background-color: #ffffff;" title="White"></div>
                    <div class="color-preset" data-color="#888888" style="background-color: #888888;" title="Gray"></div>
                    <div class="color-preset" data-color="#444444" style="background-color: #444444;" title="Dark Gray"></div>
                    <div class="color-preset" data-color="#000000" style="background-color: #000000;" title="Black"></div>
                </div>
                <div class="custom-color-section">
                    <label for="customColorInput">Custom Color:</label>
                    <input type="color" id="customColorInput" value="#ffffff">
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/three@0.158.0/build/three.min.js"></script>

    <script src="https://unpkg.com/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="js/mapManager.js"></script>
    <script src="js/gridGenerator.js"></script>
    <!-- New modular architecture -->
    <script src="js/core/SceneManager.js"></script>
    <script src="js/core/CameraController.js"></script>
    <script src="js/systems/BlockSystem.js"></script>
    <script src="js/systems/GridRenderer.js"></script>
    <script src="js/systems/MapOverlay.js"></script>
    <script src="js/systems/WaterSystem.js"></script>
    <script src="js/systems/CloudSystem.js"></script>
    <script src="js/systems/CharacterSystem.js"></script>
    <script src="js/interaction/InteractionHandler.js"></script>
    <script src="js/app/blockBuilder.js"></script>
    <script src="js/app.js"></script>
</body>
</html> 